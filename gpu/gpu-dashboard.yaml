# Source: console-plugin-nvidia-gpu/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-console-plugin-nvidia-gpu
  labels:
    helm.sh/chart: console-plugin-nvidia-gpu-0.2.5
    app.kubernetes.io/name: console-plugin-nvidia-gpu
    app.kubernetes.io/version: "latest"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: console-plugin-nvidia-gpu
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/part-of: console-plugin-nvidia-gpu
data:
  dcgm-metrics.csv: |
    DCGM_FI_PROF_GR_ENGINE_ACTIVE, gauge, gpu utilization.
    DCGM_FI_DEV_MEM_COPY_UTIL, gauge, mem utilization.
    DCGM_FI_DEV_ENC_UTIL, gauge, enc utilization.
    DCGM_FI_DEV_DEC_UTIL, gauge, dec utilization.
    DCGM_FI_DEV_POWER_USAGE, gauge, power usage.
    DCGM_FI_DEV_POWER_MGMT_LIMIT_MAX, gauge, power mgmt limit.
    DCGM_FI_DEV_GPU_TEMP, gauge, gpu temp.
    DCGM_FI_DEV_SM_CLOCK, gauge, sm clock.
    DCGM_FI_DEV_MAX_SM_CLOCK, gauge, max sm clock.
    DCGM_FI_DEV_MEM_CLOCK, gauge, mem clock.
    DCGM_FI_DEV_MAX_MEM_CLOCK, gauge, max mem clock.
---
# Source: console-plugin-nvidia-gpu/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    service.alpha.openshift.io/serving-cert-secret-name: plugin-serving-cert
  name: release-name-console-plugin-nvidia-gpu
  labels:
    helm.sh/chart: console-plugin-nvidia-gpu-0.2.5
    app.kubernetes.io/name: console-plugin-nvidia-gpu
    app.kubernetes.io/version: "latest"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: console-plugin-nvidia-gpu
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/part-of: console-plugin-nvidia-gpu
spec:
  ports:
    - name: 9443-tcp
      protocol: TCP
      port: 9443
      targetPort: 9443
  selector:
    app.kubernetes.io/name: console-plugin-nvidia-gpu
  type: ClusterIP
  sessionAffinity: None
---
# Source: console-plugin-nvidia-gpu/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: release-name-console-plugin-nvidia-gpu
  labels:
    helm.sh/chart: console-plugin-nvidia-gpu-0.2.5
    app.kubernetes.io/name: console-plugin-nvidia-gpu
    app.kubernetes.io/version: "latest"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: console-plugin-nvidia-gpu
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/part-of: console-plugin-nvidia-gpu
    app.openshift.io/runtime-namespace: console-plugin-nvidia-gpu
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: console-plugin-nvidia-gpu
  template:
    metadata:
      labels:
        app.kubernetes.io/name: console-plugin-nvidia-gpu
    spec:
      securityContext:
        runAsNonRoot: true
      containers:
      - name: console-plugin-nvidia-gpu
        image: "quay.io/edge-infrastructure/console-plugin-nvidia-gpu:latest"
        # registry.ocp.skt.local:5019/ai-poc2/console-plugin-nvidia-gpu:latest
        imagePullPolicy: Always
        securityContext:
          allowPrivilegeEscalation: false
        ports:
        - containerPort: 9443
          protocol: TCP
        volumeMounts:
        - name: plugin-serving-cert
          readOnly: true
          mountPath: /var/serving-cert
        resources:
            {}
      volumes:
      - name: plugin-serving-cert
        secret:
          secretName: plugin-serving-cert
          defaultMode: 420
      - name: nginx-conf
        configMap:
          name: nginx-conf
          defaultMode: 420
      restartPolicy: Always
      dnsPolicy: ClusterFirst
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%
      maxSurge: 25%
---
# Source: console-plugin-nvidia-gpu/templates/consoleplugin.yaml
apiVersion: console.openshift.io/v1
kind: ConsolePlugin
metadata:
  name: release-name-console-plugin-nvidia-gpu
  namespace: default
  labels:
    helm.sh/chart: console-plugin-nvidia-gpu-0.2.5
    app.kubernetes.io/name: console-plugin-nvidia-gpu
    app.kubernetes.io/version: "latest"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: console-plugin-nvidia-gpu
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/part-of: console-plugin-nvidia-gpu
spec:
  displayName: 'Console Plugin NVIDIA GPU Template'
  backend:
    type: Service
    service:
      name: release-name-console-plugin-nvidia-gpu
      namespace: default
      port: 9443
      basePath: /
---
# Source: console-plugin-nvidia-gpu/templates/tests/test-plugin-service.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "release-name-service-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: release-name-service-test
      image: quay.io/cilium/alpine-curl:v1.4.0
      imagePullPolicy: "Always"
      args:
        - -XGET
        - --silent
        - --fail
        - --insecure
        - https://release-name-console-plugin-nvidia-gpu.default.svc:9443/plugin-manifest.json
  restartPolicy: Never